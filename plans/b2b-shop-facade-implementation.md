["Shop Layout] --> B[Navbar]\n        B --> B1[Logo]\n        B --> B2[Search]\n        B --> B3[Cart Icon + Counter]\n        B --> B4[Profile Icon]\n        \n        A --> C[Shop Page]\n        C --> C1[Distributor Data]\n        C --> C2[Product Catalog]\n        C2 --> C3[Product Cards]\n        C3 --> C4[Variant Selector]\n        C3 --> C5[Smart Price Display]\n        C3 --> C6[Add to Cart Button]\n    end\n    \n    subgraph \"State Management", "D[Cart Context Provider]\n        D --> D1[Cart Items State]\n        D --> D2[Add Item Function]\n        D --> D3[Remove Item Function]\n        D --> D4[Update Quantity Function]\n        D --> D5[Clear Cart Function]\n    end\n    \n    subgraph \"Data Layer", "E[Supabase Server Client]\n        E --> E1[getDistributorBySlug]\n        E --> E2[getActiveProductsByDistributor]\n        E --> E3[getProductVariants]\n    end\n    \n    C3 --> D\n    C1 --> E\n    C2 --> E\n```\n\n## Data Models\n\n### Distributor (from types/supabase.ts)\n```typescript\n{\n  id: string\n  name: string\n  slug: string\n  logo_url: string | null\n  is_active: boolean | null\n  // ... other fields\n}\n```\n\n### Product (from types/supabase.ts)\n```typescript\n{\n  id: string\n  name: string\n  distributor_id: string\n  image_url: string | null\n  is_active: boolean | null\n  base_price: number\n  // ... other fields\n}\n```\n\n### Product Variant (from types/supabase.ts)\n```typescript\n{\n  id: string\n  product_id: string\n  name: string\n  sku: string\n  price: number\n  pack_units: number\n  stock_virtual: number | null\n  is_active: boolean | null\n  // ... other fields\n}\n```\n\n## Implementation Steps\n\n### 1. Cart Context (lib/contexts/CartContext.tsx)\nCreate a React Context for managing cart state locally in the browser.\n\n**Features:**\n- Store cart items in localStorage for persistence\n- Track total items count for navbar badge\n- Add items with selected variant\n- Update quantities\n- Remove items\n- Clear cart\n\n**Type Definitions:**\n```typescript\ninterface CartItem {\n  productId: string\n  variantId: string\n  productName: string\n  variantName: string\n  price: number\n  packUnits: number\n  quantity: number\n  imageUrl: string | null\n}\n\ninterface CartContextType {\n  items: CartItem[]\n  totalItems: number\n  addItem: (item: Omit<CartItem, 'quantity'>) => void\n  updateQuantity: (variantId: string, quantity: number) => void\n  removeItem: (variantId: string) => void\n  clearCart: () => void\n}\n```\n\n### 2. Shop Layout (app/(shop)/layout.tsx)\nCreate the shared layout for all shop pages.\n\n**Components:**\n- **Navbar (Mobile-First):**\n  - Distributor logo (from slug)\n  - Product search input\n  - Cart icon with item counter badge\n  - Profile icon\n  - Responsive design: hamburger menu on mobile, full navbar on desktop\n\n**Structure:**\n```typescript\n// app/(shop)/layout.tsx\nexport default async function ShopLayout({\n  children,\n  params\n}: {\n  children: React.ReactNode\n  params: Promise<{ slug: string }>\n}) {\n  const { slug } = await params\n  const distributor = await getDistributorBySlug(slug)\n  \n  if (!distributor) {\n    notFound()\n  }\n  \n  return (\n    <CartProvider>\n      <ShopNavbar distributor={distributor} />\n      <main>{children}</main>\n    </CartProvider>\n  )\n}\n```\n\n### 3. Shop Page (app/(shop)/shop/[slug]/page.tsx)\nCreate the main product catalog page.\n\n**Features:**\n- Fetch distributor by slug (404 if not found)\n- Fetch ACTIVE products with their variants\n- Display products in a responsive grid\n- Each product shows:\n  - Product image\n  - Product name\n  - Variant selector (dropdown or buttons)\n  - Smart price display (variant price + price per unit)\n  - \"Add to Order", "button\n\n**Data Fetching:**\n```typescript\n// New query function needed\nexport async function getActiveProductsByDistributor(distributorId: string) {\n  const { data: products, error } = await adminClient\n    .from('products')\n    .select(`\n      *,\n      product_variants (\n        id,\n        name,\n        sku,\n        price,\n        pack_units,\n        stock_virtual,\n        is_active\n      )\n    `)\n    .eq('distributor_id', distributorId)\n    .eq('is_active', true)\n    .order('name', { ascending: true })\n  \n  // Filter to only include products with active variants\n  return products?.filter(p => \n    p.product_variants?.some(v => v.is_active === true)\n  ) || []\n}\n```\n\n### 4. Product Card Component (components/shop/ProductCard.tsx)\nCreate a reusable product card component.\n\n**Features:**\n- Display product image with fallback\n- Show product name\n- Variant selector (using shadcn/ui Select component)\n- Smart price display:\n  - Primary: Variant price (e.g., $72.000)\n  - Secondary: Price per unit (e.g., $3.000/ud)\n  - Calculation: `price / pack_units`\n- \"Add to Order", "button\n- Stock indicator (optional)\n\n**Price Display Logic:**\n```typescript\nconst pricePerUnit = variant.price / variant.pack_units\n// Display: $72.000 (Caja) - $3.000/ud\n```\n\n### 5. Not Found Page (app/(shop)/shop/[slug]/not-found.tsx)\nCreate a custom 404 page for invalid distributor slugs.\n\n**Content:**\n- Friendly error message\n- Link to go back home\n- Suggestion to check the URL\n\n## File Structure\n\n```\napp/\n\u251c\u2500\u2500 (shop)/\n\u2502   \u251c\u2500\u2500 layout.tsx                    # Shop layout with navbar\n\u2502   \u2514\u2500\u2500 shop/\n\u2502       \u2514\u2500\u2500 [slug]/\n\u2502           \u251c\u2500\u2500 page.tsx              # Product catalog\n\u2502           \u2514\u2500\u2500 not-found.tsx         # 404 page\ncomponents/\n\u251c\u2500\u2500 shop/\n\u2502   \u251c\u2500\u2500 ProductCard.tsx               # Product card component\n\u2502   \u251c\u2500\u2500 ShopNavbar.tsx                # Navbar component\n\u2502   \u2514\u2500\u2500 VariantSelector.tsx           # Variant selector component\nlib/\n\u251c\u2500\u2500 contexts/\n\u2502   \u2514\u2500\u2500 CartContext.tsx               # Cart state management\n\u2514\u2500\u2500 queries/\n    \u2514\u2500\u2500 shop.ts                       # Shop-specific queries\n```\n\n## Technical Decisions\n\n### State Management\n- **Choice:** React Context with localStorage persistence\n- **Reason:** Simple, no additional dependencies needed, sufficient for local cart state\n- **Alternative considered:** Zustand (would require npm install)\n\n### Variant Selector UI\n- **Choice:** Dropdown using shadcn/ui Select component\n- **Reason:** Clean UI, handles many variants well, consistent with existing design system\n- **Alternative:** Button group (better for 2-3 variants)\n\n### Price Display Format\n- **Format:** `$72.000 (Caja) - $3.000/ud`\n- **Components:**\n  - Main price: Variant price with variant name in parentheses\n  - Unit price: Calculated as `price / pack_units` with \"/ud", "suffix\n\n### Mobile-First Design\n- **Approach:** Start with mobile layout, enhance for desktop\n- **Key considerations:**\n  - Navbar collapses to hamburger menu on mobile\n  - Product grid: 1 column on mobile, 2-3 on tablet, 3-4 on desktop\n  - Touch-friendly button sizes (min 44px height)\n\n## Dependencies Required\n- None (using existing dependencies)\n- Optional: `zustand` if preferred over React Context\n\n## Next Steps\n1. Review and approve this plan\n2. Switch to Code mode to implement\n3. Test the complete flow\n4. Iterate based on feedback"]